---
title: "Deploy to production"
description: "A guide for deploying Ponder apps to production"
---

import { Steps } from "nextra/components";
import { Callout } from "nextra/components";

# Deploy

You can deploy your Ponder app to any cloud environment that supports Node.js.

- [Railway](#railway)
- [Self-hosting](#self-hosting)

## Database schemas

The first thing you should consider when deploying your Ponder app is where your data will be stored. Ponder uses [database schemas](https://www.postgresql.org/docs/current/ddl-schemas.html) to isolate data between deployments.

### Configure your schema

The database schema must be configured using either an environment variable or a CLI flag.

<div className="code-columns">

```sh filename=".env.local"
DATABASE_SCHEMA=my_schema
```

```sh
ponder start --schema my_schema
```

</div>

<Callout type="default">
  To provide more visibility into which schemas are being used, Ponder provides
  several [CLI entrypoints](/docs/...).
</Callout>

### Schema rules

Ponder follows a strict set of rules for every new deployment.

<Callout type="info">
  In summary, a new deployment should use a new schema, or else the deployment
  will fail. There is a special case for [crash recovery](#crash-recovery).
</Callout>

```mermaid
flowchart TD
  A[Is target schema empty?]
  C[Is a crash recovery possible?]
  D(Error)
  E[Create tables]
  F[Recover from existing tables]
  G(Start)

  A -- yes --> E
  A -- no --> C
  C -- yes --> F
  C -- no --> D
  E --> G
  F --> G
  style D fill:#f00
  style G fill:#0f0
```

## Railway

[Railway](https://railway.app)'s general-purpose cloud platform is a great starting point for most Ponder apps.

<Steps>

### Log in to Railway

Connect your GitHub account, and make sure that your Ponder app has been pushed to remote.

### Create a Ponder app service

From the Railway console:

1. Click **New Project** → **Deploy from GitHub repo** and select your repo from the list
2. Click **Add variables**, then add RPC URLs (e.g. `PONDER_RPC_URL_1`) and other environment variables
3. Create a public domain. In **Settings** → **Networking**, click **Generate Domain**
4. Set the healthcheck path and timeout. In **Settings** → **Deploy**, set the **Healthcheck Path** to `/ready` and the **Healthcheck Timeout** to `86400` seconds (1 day)

<Callout type="warning">
  _Monorepo users:_ Configure the **Root Directory** and **Start Command** such
  that `ponder start` runs at the Ponder project root. For example, set the root
  directory to `packages/ponder` or set the start command to `cd packages/ponder
  && pnpm start`.
</Callout>

### Create a Postgres database

From the new project dashboard:

1. Click **Create** → **Database** → **Add PostgreSQL**
2. Open the **Variables** tab for the Ponder app service, click **New Variable** → **Add Reference** → select `DATABASE_URL` and click **Add**

### Configure deployment behavior

At this point, you need to configure your [database schema](#database-schemas) with the `DATABASE_SCHEMA` environment variable.

1. **Git based auto-deployments:** A new deployment is created every time a commit is pushed to the default branch.
   - Set `DATABASE_SCHEMA` to `${{RAILWAY_DEPLOYMENT_ID}}`
2. **Manual deployments:** A new deployment is created manually via the Railway ui.
   - Set `DATABASE_SCHEMA` to a custom value
   - In **Settings** → **Source**, disconnect the git branch

After a moment, the Ponder app service should redeploy successfully. Check the **Build Logs** and **Deploy Logs** tabs to debug any issues.

</Steps>

## Self hosting

In general, hosting a Ponder app is similar to hosting a normal Node.js HTTP server. Rather than offer a step-by-step guide, this section describes the key Ponder-specific quirks to consider when self-hosting.

### Health checks & probes

Use the `/health` and `/ready` endpoints to configure health checks or [probes](https://kubernetes.io/docs/concepts/configuration/liveness-readiness-startup-probes/).

- **`/health`**: Returns an HTTP `200` response immediately after the process starts.
- **`/ready`**: Returns an HTTP `200` response once indexing progress has reached realtime across all chains. During the historical backfill, the endpoint returns an HTTP `503` response.

### Database connection

<Callout type="warning">
  Your app will have performance issues if the roundtrip database latency
  exceeds ~20 milliseconds. This is common when using a database in different
  private network or region.
</Callout>

In production, Ponder works best with a Postgres database in the same private network. Set the `DATABASE_URL` environment variable to the connection string of your Postgres database, or manually override the `database.connectionString` option in `ponder.config.ts`.

```ts filename="ponder.config.ts" {6}
import { createConfig } from "ponder";

export default createConfig({
  database: {
    kind: "postgres",
    connectionString: "postgres://user:password@mycloud.internal:5432/database",
  },
  // ... more config
});
```

### Crash recovery

If a Ponder app running `ponder start` crashes and restarts, it will attempt to resume indexing where it left off. [Read more](/docs/api-reference/database#build-id-and-crash-recovery) about the instance lifecycle and crash recovery mechanism.
